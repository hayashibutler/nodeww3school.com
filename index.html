<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>Node ww3school</title>
	<link rel="stylesheet" type="text/css" href="style.css">
</head>
<body>
<button class="nodetest" ><a href="nodetest.js">Node</a></button>
<h1 class="body">Node & Expressjs tren F8</h1>
<h2>Lay gia tri value</h2>
<h3>GET dung query</h3>
<pre>
	app.get('/search', (req, res) => {
	  // console.log(req.query.q)
	  res.render('search')
	});
</pre>
<p>tra ra gia tri</p>
<h3>POST dung body</h3>
<pre>
	app.post('/search', (req, res) => {
	  console.log(req.body)
	  res.send('ket qua')
	});
</pre>
<p>gui du lieu dang form</p>
<p>Tra du lieu undefined. vi trong express khong tich hop san.</p>
<p>Can phai goi method trong express (midleware)</p>
<pre>
	app.use(express.urlencoded({extended: true})) // POST, gui du lieu dang Form Data
	app.use(express.json()) // POST javascript (XMLHttpRequest, fetch, axios)
</pre>
<h2 class="body">MongoDB</h2>
<h3>Cài mongoDB server 4.4.8 và Compass (cài 5.0.2 bị lỗi) </h3>
<h3>Lệnh tạo thư mục chưa data</h3>
<pre>
// Tạo thư mục
sudo mkdir -p ~/Documents/mondodb-data

// cấp toàn quyền cho thư mục
sudo chmod 777 ~/Documents/mondodb-data

// chạy monngodb
mongod --dbpath ~/Documents/mondodb-data
</pre>

<h1 class="body">Kien thuc Nodejs ngoai</h1>
<p class="body">Nguon: <a href="https://www.youtube.com/watch?v=fPf88MxlnEQ&list=PLqnlyu33Xy-6g7IqU5-3BXOfewcJKoL08&index=11" target="_blank">video Youtube</a></p>
<h2>Module</h2>
<h3>Tao module</h3>
<ul>
<li>module.exports</li>
</ul>
<pre>
	//bar.js
	module.exports = function(){
	  console.log('Hello')
	}</pre>
<h3>Goi module</h3>
<ul>
<li>require</li>
</ul>
<pre>
	//app.js
	var bar = require('./bar.js');
	bar();
</pre>
<h2>Khai bao va su dung function</h2>
<pre>
	function sayHello(){
	  console.log('I say Hello!!')
	}

	sayHello();
	
	//first-class function
	function callSay(fn){
	  fn()
	}

	callSay(sayHello);//thay fn bang sayHello
</pre>
<h2>Prototype ke thua</h2>
<h3>format theo ngay VN</h3>
<pre>
	Date.prototype.format = function(){
	  var yyyy = this.getFullYear();
	  var mm = this.getMonth() + 1;
	  var dd = this.getDate();
	  var hours = this.getHours();
	  var minutes = this.getMinutes(); 
	  return dd + '-' + mm + "-" + yyyy + "\n" + hours +":"+minutes;
	}

	var now = new Date();
	var oneDay = new Date(2021,10,2);

	console.log(now.format());
	console.log(oneDay.format());
</pre>
<h3>user ke thua person</h3>
<pre>
	function Person(name, password){
	  this.name = name;
	  this.password = password;
	}
	Person.prototype.getName = function(){
	  return this.name;
	}

	Person.prototype.getPassword = function(){
	  return this.password
	}

	Person.prototype.getLevel = function(){
	  return this.level;
	}
	Person.prototype.level = "admin"

	function User(name){
	  this.name = name;
	}
	User.prototype = new Person();

	var person1 = new Person("Teo", "1234")
	console.log(person1.getName() +" "+person1.getPassword()+" "+person1.level)

	var person2 = new User("Teo", "1234")
	console.log(person2.getName() +" "+person2.getPassword()+" "+person2.level)
</pre>
<b>ket qua</b>
<p>Teo 1234 admin</p>
<p>Teo undefined admin</p>
<h3>Ham tu chay</h3>
<pre>
	(function(lname){
	  var fname = "Hoa";
	  console.log(fname);
	  console.log(lname)
	}("Phuong"))
</pre>
<h2>Ket hop nhieu module</h2>
<p>Tep 20tkvlogs</p>
<ul><li>app.js ngoai cung</li></ul>
<pre>
	var greet = require("./greet/index.js") // hoac ./greet
	
	greet.english2();
	greet.vietnamese2();
</pre>
<ul><li>thu muc greet</li></ul>
<b>greetings.json</b>
<pre>
	{
	    "en": "Hello",
	    "vi": "xin chao"
	}
</pre>
<b>english.js</b>
<pre>
	var greeting = require("./greetings.json")

	var sayHello = function(){
	    console.log(greeting.en)
	};

	module.exports = sayHello;
</pre>
<b>vietnamese.js</b>
<pre>
	var greeting = require("./greetings.json")

	var sayHello = function(){
	    console.log(greeting.vi)
	};

	module.exports = sayHello;
</pre>
<b>index,js</b>
<pre>
	var englis1 = require("./english");
	var vietnames1 = require("./vietanmese")

	module.exports = {
	    english2: englis1,
	    vietnamese2: vietnames1
	}
</pre>
<h2>Cac cach khai bao module</h2>
<p><p>Tep 20tkvlogs</p></p>
<h3>Hello1.js</h3>
<pre>
	module.exports = function(){
	    console.log("Hello1 word")
	}
</pre>
<b>app.js</b>
<pre>
	var hello1 = require("./hello1");
	hello1();
</pre>
<h3>Hello2.js</h3>
<p>module.exports la object, co the gan thuoc tinh</p>
<pre>
	module.exports.sayHello = function() {
	    console.log("Hello2 word")
	}
</pre>
<b>app.js (1)</b>
<pre>
	var hello2a = require("./hello2");
	hello2a.sayHello();
</pre>
<b>app.js (2)</b>
<pre>
	var hello2b = require("./hello2").sayHello;
	hello2b();
</pre>
<h3>Hello3.js</h3>
<p>Tao doi tuong va khoi tao san</p>
<pre>
	function Person(){
	    this.message = "Hello3 word",
	    this.sayHello = function() {
	        console.log(this.message)
	    }
	}
	module.exports = new Person()
</pre>
<b>app.js</b>
<pre>
	var hello3 = require("./hello3");
	hello3.sayHello();

	hello3.message = "change hello3 world"
	hello3.sayHello()
</pre>
<h3>Hello4.js</h3>
<p>tao doi' tuong nhung chua khoi tao san</p>
<pre>
	function Person(){
	    this.message = "Hello4 word",
	    this.sayHello = function() {
	        console.log(this.message)
	    }
	}
	module.exports = Person;
</pre>
<b>app.js</b>
<pre>
	var Hello4 = require("./hello4");
	var hello4 = new Hello4();
	hello4.sayHello();
</pre>
<h3>Hello5.js</h3>
<p>exports nhu 1 doi' tuong</p>
<pre>
	var message = "Hello 5 word"
	function sayHello(){
	    console.log(message)
	}
	module.exports = {
	    sayHello: sayHello
	}
</pre>
<b>app.js (1)</b>
<pre>
	var hello5a = require("./hello5");
	hello5a.sayHello();
</pre>
<b>app.js (2)</b>
<pre>
	var hello5b = require("./hello5").sayHello;
	hello5b();
</pre>


<h2>Su dung module dung san nodejs</h2>
<h3>util.format</h3>
<pre>util.format(format, arg1, arg2,...);</pre>
<ul>
	<li>%s string</li>
	<li>%d number</li>
	<li>%j chuoi JSON</li>
	<li>%i parseInt(value, 10)</li>
</ul>
<pre>
	var util = require("util")

	var lname = "Hoa";
	var fname = "Nguyen"
	var fullName = util.format('%s Thi %s', fname, lname);
	console.log(fullName) //Nguyen Thi Hoa

	util.log(fullName) //15 Aug 15:47:11 - Nguyen Thi Hoa
</pre>
<h2>Event Emitter (P1) gia lap events</h2>
<p>Tep 28tkvlogs</p>
<b>emiiter.js</b>
<pre>
	function Emitter(){
	    this.events = {};
	}

	Emitter.prototype.on = function(type, listener){
	    this.events[type] = this.events[type] || [];
	    this.events[type].push(listener);
	}

	// Emitter.prototype.emit = function(type){
	//     if (this.events[type]) {
	//         this.events[type].forEach(function(listener) {
	//             listener();
	//         });
	//     } else console.log("chua cap nhat thong bao")
	// }

	Emitter.prototype.emit = function(type){
	    if (this.events[type]) {
	        this.events[type].forEach(function(listener){
	            console.log(listener)
	        })
	    } else console.log("chua cap nhat thong bao")
	}
	module.exports = Emitter;
</pre>

<b>app.js</b>
<pre>
	var Emitter = require("./emitter");

	var emitter = new Emitter();

	// emitter.on("bad", function() {
	//     console.log("Mot mon nao do bi diem kem!")
	// })

	// emitter.on("bad", function(){
	//     console.log("Diem kem, can thong bao den phu huynh")
	// })

	emitter.on("bad","Mot mon nao do diem kem")
	emitter.on("bad","thong bao phu huynh")

	var score = [10,4];
	for(var s of score) {
	    if(s < 5) {
	        console.log("Diem qua thap");
	        emitter.emit("bad")
	    }
	}

</pre>
<h2>Event Emitter (P2) events trong nodejs</h2>
<pre>emitter.on(eventName, listener)</pre>
<p>listener la 1 cai function</p>
<b>config.js</b>
<pre>
	module.exports = {
	    events: {
	        BAD_SCORE: "bad",
	        USER_CONNECTED: "connected"
	    }
	}
</pre>
<b>app.js</b>
<pre>
	var Emitter = require("events");
	var eventConfig = require("./config")

	var emitter = new Emitter();

	emitter.on(eventConfig.BAD_SCORE, function() {
	    console.log("Mot mon nao do bi diem kem!")
	})

	emitter.on(eventConfig.BAD_SCORE, function(){
	    console.log("Diem kem, can thong bao den phu huynh")
	})

	var score = [10,4];
	for(var s of score) {
	    if(s < 5) {
	        console.log("Diem qua thap");
	        emitter.emit(eventConfig.BAD_SCORE)
	    }
	}
</pre>
<h2>object.create và prototypes</h2>
<pre>
	var person = {
	    fname: "",
	    lname: "",
	    getFullName: function(){
	        return this.fname + " " + this.lname
	    }
	}

	var hoa = Object.create(person);
	hoa.fname = "Thi";
	hoa.lname = "Hoa";
	console.log(hoa.getFullName())
</pre>
<h2>Kế thừa Event emitter (P1)</h2>
<pre>
	var EventEmitter = require("events");
	var util = require("util");

	function Dialog(){
	    this.message = "Hello world!";
	}

	util.inherits(Dialog, EventEmitter);

	Dialog.prototype.sayHello = function(data){
	    console.log(this.message +" "+ data);
	    this.emit("hello", data)
	}

	var dialog = new Dialog();

	dialog.on("hello", function(data){
	    console.log("Co 1 loi chao, "+data)
	})

	dialog.sayHello("Hoa")
</pre>
<h2>ES6 Template literals</h2>
<pre>
	var person = {
		name: "Hoa",
		age: 25
	}

	console.log("Toi la " + person.name + ", toi " + person.name + "tuoi")
	//template literals
	console.log(`Toi la ${person.name}, toi ${person.age} tuoi`)

</pre>
<b>Note</b>
<p>Xuong dong thoai mai, format du'ng voi template</p>
<h2>Javascript .call và .apply</h2>
<pre>
	var obj = {
	    name: "Hoa",
	    sayHello: function(){
	        console.log(`Hello ${this.name}`)
	    }
	}

	obj.sayHello();
	// thay doi gia tri thuoc tinh
	obj.sayHello.call({name: "Phuong"}) // return Hello Phuong
	// thay doi gia tri thuoc tinh
	obj.sayHello.apply({name: "Tien"}) // return Hello Tien
</pre>
<b>truy tham so param1, param2</b>
<pre>
	var obj = {
	    name: "Hoa",
	    sayHello: function(param1, param2){
	        console.log(`Hello ${this.name}`);
	        console.log(`Params:`, param1, param2)
	    }
	}

	obj.sayHello("nam", "2018");
	// thay doi gia tri thuoc tinh, truyen tham so tung phan
	obj.sayHello.call({name: "Phuong"}, "nam", "2019") // return Hello Phuong
	// thay doi gia tri thuoc tinh, truyen tham so array
	obj.sayHello.apply({name: "Tien"}, ["nam", "2020"]) // return Hello Tien
</pre>
<h2>Kế thừa Event emitter (P2)</h2>
<pre>
	var util = require("util");

	function Person(){
	    this.fname = "Hoa";
	    this.lname = "Mai"
	}

	Person.prototype.sayHello = function(){
	    console.log("Hello " + this.lname +" "+this.fname)
	}

	function Student(){
	    Person.call(this); //goi luon gia tri cua thuoc tinh Hoa, Mai
	    this.id = "1234"
	}

	util.inherits(Student, Person);

	var sv = new Student();

	console.log(sv);
	console.log(sv.id);
	sv.sayHello();
</pre>
<h2>ES6 class</h2>
<b>dung 'use strict' de su dung class</b>
<p>1 cach tao doi' tuong ke thua, thay cho prototype</p>
<pre>
	'use strict'

	class Person{
	    constructor(lname, fname){
	        this.lname = lname,
	        this.fname = fname
	    }

	    // dinh nghia function
	    sayHello() {
	        console.log("Hello "+this.lname+" "+this.fname)
	    }
	}
	----thay the----
	function Person(){
	  this.fname = "Hoa";
	  this.lname = "Mai"
	}

	Person.prototype.sayHello = function(){
	    console.log("Hello " + this.lname +" "+this.fname)
	}
	----thay the----

	var hoa = new Person("Hoa", "Mai")
	hoa.sayHello();
</pre>
<h2> Event emitter (P3)</h2>
<p>viet lai emitter P1 voi class</p>
<b>dung extend de ke thua, va dung super() de su dung</b>
<p>tep 36tkvlogs</p>
<pre>
	'use strict'

	var EventEmitter = require("events");

	class Dialog extends EventEmitter {
	    constructor(){
	        super();
	        this.message = "Hello world"
	    }
	    sayHello(data){
	        console.log(`${this.message}: ${ data }`);
	        this.emit("hello", data)
	    }
	}

	var Dialog = require("./dialog")

	var dialog = new Dialog();

	dialog.on("hello", function(data){
	    console.log("Co 1 loi chao, "+data)
	})

	dialog.sayHello("Hoa")
</pre>
<h2>Callback</h2>
<p>chi goi 1 ham cuoi, cac ham trong setTimeout se thuc hien truoc</p>
<b>setTimeout()</b>
<pre>
	function firstFn(){
	    console.log("ham 1, khong can goi")
	}

	function secondFn(){
	    setTimeout(firstFn,3000);
	    console.log("ham 2, chi can goi")
	}

	secondFn();

	//ham 2, chi can goi
	//ham 1, khong can goi
</pre>

<h2>stream va buffer</h2>
<h2>Buffer</h2>
<p>lam viec voi bang ma ki tu</p>
<pre>
	var buffer = new Buffer("Xin chào", "utf8")

	console.log(buffer) //58 69 6e 20 63 68 61 6f

	console.log(buffer.toString()) //Xin chao (mac dinh "utf8")
	console.log(buffer.toString("ascii")) //Xin chC o
	console.log(buffer.toJSON()) // {type: 'Buffer', data: [88, 105, 110,  32,  99, 104, 195, 160,  111]}
</pre>
<h2>TypedArray</h2>
<p>Int8Array, Int16Array, Int32Array, Float64Array</p>
<pre>
	var buffer = new ArrayBuffer(4);

	var view = new Int8Array(buffer);

	view[0] = 5;
	view[1] = 10;
	view[2] = 3;

	console.log(buffer) //ArrayBuffer { [Uint8Contents]: <05 0a 03 00>, byteLength: 4 }

	console.log(view) //Int8Array(4) [ 5, 10, 3, 0 ]

</pre>
<h2>Callback (p2)</h2>
<pre>
	function readData(callback){
	    // read done
	    var user = {
	        name: "Hoa"
	    }
	    callback(user)
	}

	readData(function(data){
	    console.log("read data lan 1 ")
	    console.log("Data : ", data)
	})

	readData(function(data){
	    console.log("read data lan 2")
	    console.log("User : " + data.name)
	})
</pre>
<h2>File (fs)</h2>
<pre>
	var fs = require("fs")

	// readFileSync (dong bo)
	var read = fs.readFileSync(__dirname + "/database.txt", "utf8");
	console.log(read)

	// readFile (khong dong bo)
	fs.readFile(__dirname + "/database.txt","utf8", function(err, data){
	    console.log(data)
	})

</pre>
<h2>stream</h2>
<p>chunk la manh nho cua stream</p>
<pre>
	var fs = require("fs");

	var readFile = fs.createReadStream(__dirname + "/database.txt", {
	    encoding: "utf8",
	    highWaterMark: 1024*70 //10k
	})
	var writeFile = fs.createWriteStream(__dirname + "/database2.txt")

	readFile.on("data", function(chunk){
	    console.log(chunk.length) //mac dinh la 64k tra ve. highWaterMark de thay doi
	    writeFile.write(chunk);
	    console.log("coppied")
	})
</pre>
<h2>PIPE dung voi thu vien zlib</h2>
<pre>
	var fs = require("fs");
	// thu vien nen file
	var zlib = require("zlib")

	var readFile = fs.createReadStream(__dirname + "/database.txt", {
	    encoding: "utf8"
	});

	var writeFile = fs.createWriteStream(__dirname + "/database2.txt")
	// tao 1 file nen
	var gzip = zlib.createGzip()
	// noi luu file da nen
	var compress = fs.createWriteStream(__dirname + "/database.txt.gz")

	//copy
	readFile.pipe(writeFile);

	//compress. gzip tao file ne, compress de luu file
	readFile.pipe(gzip).pipe(compress)
</pre>
<h2>TCP/IP</h2>
<h2>server voi Nodejs</h2>
<pre>
	var http = require("http")

	http.createServer(function(req, res){

	    res.writeHead(200, {'Content-Type': 'text/plain'})
	    res.end("hello web from Nodejs")

	}).listen(1111, "127.0.0.1")
</pre>
<h2>Mo html tren nodejs server</h2>
<pre>
	var http = require("http")
	var fs = require("fs")

	http.createServer(function(req, res){

	    res.writeHead(200, {'Content-Type': 'text/html'})
	    var html = fs.readFileSync(__dirname + "/index.html", "utf-8")

	    var user = "Hoa Mai";
	    html = html.replace("user", user)

	    res.end(html)

	}).listen(1111, "127.0.0.1")
</pre>
<h2>Cai thien hieu nang doc file voi PIPE</h2>
<b>createReadStream().pipe()</b>
<pre>
	var http = require("http");
	var fs = require("fs");

	http.createServer(function(req, res){

	    res.writeHead(200, {'Content-Type':'text/html'});
	    fs.createReadStream(__dirname + "/index.html").pipe(res);

	}).listen(1111,"127.0.0.1")
</pre>
<h2>JSON từ webserver</h2>
<pre>
	var http = require("http");
	var fs = require("fs");

	http.createServer(function(req, res){

	    res.writeHead(200, {'Content-Type':'application/json'});
	    var obj = {
	        fname: "Hoa",
	        lname: "Mai"
	    }
	    res.end(JSON.stringify(obj))
	}).listen(1111,"127.0.0.1")
</pre>
<h2>Dinh tuyen url</h2>
<pre>
	var http = require("http");
	var fs = require("fs");

	http.createServer(function(req, res){
	    if (req.url === "/" || req.url === "/index.html") {

	        res.writeHead(200, {'Content-Type':'text/html'}); // dong nay ko co cung duoc
	        fs.createReadStream(__dirname + "/index.html").pipe(res)
	    } else  if (req.url === "/api"){
	        res.writeHead(200, {'Content-Type':'application/json'}); //ko co cung duoc
	        var obj = {
	            fname: "Hoa",
	            lname: "Mai"
	        };
	        res.end(JSON.stringify(obj));
	    } else {
	        res.writeHead(404)
	        res.end("Not found")
	    }
	}).listen(1111,"127.0.0.1", function(){
	    console.log("Da khoi tao server: http://localhost:1111")
	})
</pre>
<h2>VERSIONING SEMANTIC</h2>
<a href="https://semver.org/" target="_blank">Tham khao https://semver.org/</a>
<p><b>MAJOR.MINOR.PATCH</b></p>
<p>2.0.0</p>
<ul>
	<li>MAJOR: gan nhu hoan toan moi</li>
	<li>MINOR: them tinh nang</li>
	<li>PATCH: fix bug</li>
</ul>
<h2>INT, NODEMON và PACKAGE.JSON (P1)</h2>
<pre>npm init
npm i --save lodash</pre>
<b>package.json</b>
<pre>
{
  "name": "my-app",
  "version": "1.0.0",
  "description": "my first app",
  "main": "app.js",
  "scripts": {
    "test": "echo \"Error: no test specified\" && exit 1"
  },
  "author": "lam",
  "license": "MIT",
  "dependencies": {
    "lodash": "^4.17.21"
  }
}
</pre>
<b>^4.17.21: ^ cap nhat tat ca. thay bang ~ chi cap nhat PATCH</b>
<pre>
	var _ = require("lodash")

	var array = [1];
	var other = _.concat(array,1,[2],[[4]])
	console.log(other)

	var dif = _.difference([2,1],[2,3])
	console.log(dif)

	var users = [
	    { 'user': 'barney',  'age': 36, 'active': true },
	    { 'user': 'fred',    'age': 40, 'active': false },
	    { 'user': 'pebbles', 'age': 1,  'active': true }
	  ];

	var find1 = _.find(users, function(user) {return user.age <40}, 1)
	console.log("age<40 ",find1)

	var find2 = _.find(users, ['age', 40])
	console.log("age = 40 ",find2)

	var find3 = _.find(users, {'active': true})
	console.log(find3)

	var filter = _.filter(users, function(user) {return user.age < 40})
	console.log(filter)
</pre>
<h2>NPM Global</h2>
<p>kiem tra noi chu'a node-module de cai global</p>
<pre>	npm root -g</pre>
<pre>	npm install -g ...</pre>
<h2>INT, NODEMON và PACKAGE.JSON (P2)</h2>
<p>Cai thu muc node_modules khi co san file package.json</p>
<pre>	npm install</pre>
<pre>	npm init // cai moi' hoan toan</pre>
<p>update tinh nang</p>
<pre>	npm update</pre>
<p>cai cac tien ich (ko bat buoc)</p>
<pre>	npm install mocha chai grunt --save-dev</pre>
<pre> nodemon app.js</pre>
<h2>Cài đặt EXPRESS và xây dựng một WEB SERVER hoàn chỉnh</h2>
<pre>npm install express --save</pre>
<pre>
	var express = require("express")

	var app = express();

	var port = 3000;

	app.get("/", function(req, res) {
	  res.send("&lt;h1>hello expresss&lt;/h1>")
	});
	app.get("/api", function(req, res) {
	  res.json({
	    lname: "hoa",
	    fname: "mai"
	  })
	})
	app.listen(port, function(){
	  console.log("sever: http://localhost:3000")
	})
</pre>
<h2>Routing dinh tuyen</h2>
<pre>
	app.get("/user/:id", function(req, res){
	  res.send(`Hello ${req.params.id}`)
	})
</pre>
<p>??? mo 1 trang html??</p>
<h2>MIDDLEWARE trong express</h2>
<pre>
	var express = require("express")

	var app = express();

	var port = 3000;

	//custom middleware
	app.use("/", function(req, res, next) {
	  console.log('Request URL: ', req.url);
	  req.requestTime = new Date();
	  next();
	})
	// co san
	app.use("/public", express.static(__dirname +"/public"))


	app.get("/", function(req, res) {
	  // doc file hien thi ra
	  res.send(`
	  &lt;link href="/public/style.css" rel="stylesheet" type="text/css">
	  &lt;h1>hello expresss&lt;/h1>
	  &lt;p>Request Time: ${req.requestTime}&lt;/p>
	  `)
	});
	app.get("/api", function(req, res) {
	  res.json({
	    lname: "hoa",
	    fname: "mai"
	  })
	})

	app.get("/user/:id", function(req, res){
	  res.send(`Hello ${req.params.id}`)
	})

	app.listen(port, function(){
	  console.log("sever: http://localhost:3000")
	})
</pre>
<h2>#71 TEMPLATE và TEMPLATE ENGINE</h2>
<p>tep 71tkvlogs</p>

<p>express dung duoc nhieu template</p>
<a href="https://ejs.co/" target="_blank">https://ejs.co/</a>
<pre>npm install ejs --save</pre>
<p>khong can dung var ejs = require('ejs'). Vi ejs da cai trong express. Dung lenh app.set()</p>

<pre>
	app.set('view engine', 'ejs')</pre>
<pre>
	app.get("/", function(req, res) {
	    res.render('index');
	});
</pre>
<pre>
	app.get("/user/:id", function(req, res){
	    res.render('user', { ID : req.params.id})
	})
</pre>
<h2>#72 NodeJS - QUERYSTRING và POST PARAMETER</h2>
<p>tep 72tkvlogs</p>
<pre>https://www.google.com/search?q=google&oq=go&aqs=chrome.0.69i59j69i57j35i39j0i131i433i512l2j69i60l3.2360j0j4&sourceid=chrome&ie=UTF-8</pre>
<p>Query string: q=google&oq=go&aqs=chrome.0.69i59j69i57j35i39j0i131i433i512l2j69i60l3.2360j0j4&sourceid=chrome&ie=UTF-8</p>

<p>cai middleware boby-parser tai <a href="https://expressjs.com/en/resources/middleware.html" target="_blank">express</a></p>
<p>lay thu vien <a href="https://code.jquery.com/">jQuery</a></p>

<h2>#74 NodeJS - Cấu trúc một ứng dụng</h2>
<p>Tao nhanh ung dung gom folder va file mau voi <a href="http://expressjs.com/en/starter/generator.html" target="_blank">express-generator</a></p>
<pre>npx express-generator</pre>
<h2>ANGULARJS</h2>
<p>du an note todo</p>
<p>chen vao html</p>
<p><a href="https://www.bootstrapcdn.com/" target="_blank">bootstrapCDN</a>: bo https de tu load htpp hoac https</p>
<pre>
	&lt;link rel="stylesheet" href="//cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/css/bootstrap.min.css">
	&lt;link rel="stylesheet" href="//cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/fontawesome.min.css">
</pre>

<p><a href="https://angularjs.org/">angularjs</a></p>
<pre>
&lt;script src="//ajax.googleapis.com/ajax/libs/angularjs/1.8.2/angular.min.js">&lt;/script>
</pre>
<h3>ngRepeat</h3>
<p>Dung nhu ham lap for, de hien thi danh sach</p>
<h3>ngModel</h3>
<p>lay theo trang thai true/false. Lam cai checkbox</p>
<h3>ngClass</h3>
<p>tu dong thay doi class</p>
<pre>	ng-class="{ strike: todo.isDone}</pre>
<h3>angular xeditable</h3>
<p>chinh sua noi dung</p>
<p><a href="https://cdnjs.com/libraries/angular-xeditable" target="_blank">cdn xeditable</a></p>
<p><a href="https://vitalets.github.io/angular-xeditable/" target="_blank">Su dung xeditable</a></p>




<h1 class="body">Node.js Tutorial</h1>
<h2 class="body">Node.js Get Started</h2>
<p>Tao file myfirst.js</p>
<pre>
	var http = require('http');

	http.createServer(function (req, res) {
	  res.writeHead(200, {'Content-Type': 'text/html'});
	  res.end('Hello World!');
	}).listen(8080);
</pre>
<p>Chay lenh Cmd</p>
<pre>node myfirst.js</pre>
<h2 class="body">Node.js Modules</h2>
<h3>require()</h3>
<pre>var http = require('http')</pre>
<p>tao ra 1 server</p>
<pre>
http.createServer(function (req, res) {
  res.writeHead(200, {'Content-Type': 'text/html'});
  res.end('Hello World!');
}).listen(8080);</pre>
<h3>Create Module ca nhan</h3>
<b>exports</b>
<pre>
	exports.myDateTime = function(){
		return Date();
	}
</pre>
<h2 class="body">Node.js HTTP Module</h2>
<pre>require()</pre>
<pre>createServer()</pre>

<pre>
	var http = require('http')

	// Tao 1 server object
	http.createServer(function(req, res) {
		res.write('Hello World'); // viet 1 yeu cau
		reg.end(); //ket thuc yeu cau
	}).listen(8080)
</pre>
<h3>add an HTTP Header</h3>
<pre> res.writeHead()</pre>
<pre>
	var http = require('http');
	http.createServer(function(req,res){
		res.writeHead(200, {'Content-Type': 'text/html'});
		res.write('Hello World');
		res.end();
	}).listen(8080);
</pre>
<h3>Read the Query String</h3>
<pre>
	var http = require('http');
	http.createServer(function(req, res) {
		res.writeHead(200, {'Content-Type': 'text/html'});
		res.write(req.url);
		res.end();
	}).listen(8080)
</pre>
<h3>Split the Query String</h3>
<pre>
	var http = require('http');
	var url = require('url');

	http.createServer(function(red,res) {
		res.writeHead(200, {'Content-Type': 'text/html'});
		var q = url.parse(req.url, true).query;
		var txt = q.year + " " + q.month;
		res.end(txt);
	}).listen(8080);
</pre>


<h2 class="body">Node.js File System</h2>
<pre>var fs = require('fs');</pre>
<h3>Read Files fs.readFile()</h3>
<pre>
	var http = require('http');
	var fs = require('fs');
	http.createServer(function (req,res) {
		fs.readFile('demofile1.html', function(err, data) {
			res.writeHead(200, {'Content-Type': 'text/html'});
			res.write(data);
			return res.end;
		})
	})

</pre>
<h3>Create Files</h3>
<ul>
	<li>fs.appendFile()</li>
	<li>fs.open()</li>
	<li>fs.writeFile()</li>
</ul>

<h4>fs.appendFile(), ket noi voi file, neu khong co se tu tao moi a file</h4>
<pre>
	var fs = require('fs');

	fs.appendFile('mynewfile1.txt', 'Hello content!', function(err) {
		if (err) throw err;
		console.log('Saved')
	})
</pre>
<p><b>Note</b>:'Hello content' la noi dung ghi, neu file khong ton tai, thi se tao file moi, va trong file co noi dung Hello content</p>

<h4>fs.open()</h4>
<pre>
	var fs = require('fs');

	fs.open('mynewfile2.txt', 'w', function(err,file){
		if (err) throw err;
		console.log('saved');
	})
</pre>
<p><b>Note</b>: 'w' se la bat buoc, neu file chua ton tai, se tu dong tao file moi, voi noi dung trong</p>

<h4>fs.writeFile()</h4>
<p>giong voi fs.appendFile</p>
<p><b>Note</b>: nhung no se ghi de len noi dung cua file da ton tai. con append() se cap nhat noi' them vao</p>
<pre>
	var = require('fs')

	fs.writeFile('mytextFile3.txt', 'Hello content', function(err) {
		if (err) throw err;
		console.log('saved');
	})
</pre>
<h3>Update Files</h3>
<ul>
	<li>fs.append():</li>
<p>Noi' noi dung vao cuoi' file</p>
<pre>
	var fs = require('fs')

	fs.appendFile('mynewfile1.txt', 'this is my text', function(err){
		if (err) throw err;
		console.log('updated')
	})
</pre>
	<li>fs.writeFile()</li>
<p>replace noi dung da ton tai</p>
<pre>
	var fs = require('fs');
	fs.writeFile('mynewFile3.txt', 'this is my text', function(err) {
		if (err) throw err;
		console.log('replaced')
	})
</pre>
</ul>
<h3>Delete Files fs.unlink()</h3>
<pre>
	var fs = require('fs')

	fs.unlink('mynewfile2.txt', function(err){
		if(err) throw err;
		console.log('deleted')
	})
</pre>
<h3>Rename Files fs.rename()</h3>
<pre>
	var fs = require('fs');

	fs.rename('mynewfile1.txt', 'mynamedfile1.txt', function(err){
		if(err) throw err;
		console.log('renamed')
	})
</pre>
<h2 class="body">Node.js URL</h2>
<pre>var url = require('url')</pre>
<p>url.parse() return ra object url</p>
<pre>
	var url = require('url');
	var adr = 'http://localhost:8080/default.htm?year=2017&month=february';
	var q = url.parse(adr, true);

	console.log(q.host); // return "localhost:8080"
	console.log(q.pathname); // return '/default.html'
	console.log(q.search); //return '?year=2017&month=february'

	var qdata=q.query // return object: {year: 2017,month: 'february'}
	console.log(qdata.month);// return 'february'
</pre>
<h3>Node.js File Server</h3>
<p>summer.html</p>
<p>winter.html</p>
<p>demo_fileserver.js</p>
<pre>
	var http = require('http');
	var url = require('url');
	var fs = require('fs');

	http.createServer(function (req, res) {
	  var q = url.parse(req.url, true);
	  var filename = "." + q.pathname;
	  fs.readFile(filename, function(err, data) {
	    if (err) {
	      res.writeHead(404, {'Content-Type': 'text/html'});
	      return res.end("404 Not Found");
	    } 
	    res.writeHead(200, {'Content-Type': 'text/html'});
	    res.write(data);
	    return res.end();
	  });
	}).listen(8080);
</pre>
<h2 class="body">Node.js NPM</h2>
<pre>npm install upper-case</pre>
<h2 class="body">Node.js Events</h2>

<h3>Events Module</h3>
<pre>
	var events = require('events');
	var eventEmitter = new events.EventEmitter()
</pre>
<h3>EventEmitter</h3>
<p>emit() thuc hien event</p>
<pre>
	var events = require('events');
	var eventEmitter = new events.EventEmitter();

	//Create an event handler:
	var myEventHandler = function () {
	  console.log('I hear a scream!');
	}

	//Assign the event handler to an event:
	eventEmitter.on('scream', myEventHandler);

	//Fire the 'scream' event:
	eventEmitter.emit('scream');
</pre>
<h2 class="body">Node.js Upload Files</h2>
<h3>Formidable Module</h3>
<pre>npm install formidable</pre>

<form action="fileupload" method="post" enctype="multipart/form-data">
<input type="file" name="filetoupload"><br>
<input type="submit">
</form>

<h3>Step 1: Create an Upload Form</h3>

<pre>
	var http = require('http');

	http.createServer(function (req, res) {
	  res.writeHead(200, {'Content-Type': 'text/html'});
	  res.write('&lt;form action="fileupload" method="post" enctype="multipart/form-data">');
	  res.write('&lt;input type="file" name="filetoupload">&lt;br>');
	  res.write('&lt;input type="submit">');
	  res.write('&lt;/form>');
	  return res.end();
	}).listen(8080);
</pre>
<h3>Step 2: Parse the Uploaded File</h3>

<pre>
	var http = require('http');
	var formidable = require('formidable');

	http.createServer(function(req, res){
		if (req.url == '/fileupload') {
			var form = new formidable.IncomingForm();
			form.pares(req, function(err, fields, files) {
				res.write('File uploaded');
				res.end();
			});
		} else {
			res.writeHead(200, {'Content-Type':'text/html'});
			res.write('&lt;form action="fileupload" method="post" enctype="multipart/form-data">');
			res.write('&lt;input type="file" name="filetoupload">&lt;br>');
			res.write('&lt;input type="submit">');
			res.write('&lt;/form>');
			res.end();
		}
	}).listen(8080)
</pre>

<h3>Step 3: save</h3>
<pre>
	var http = require('http');
	var formidable = require('formidable');
	var fs = require('fs');

	http.createServer(function(req,res){
	  if (req.url == '/fileupload'){
	    var form = new formidable.IncomingForm();
	    form.parse(req, function(err, fields, files){
	      var oldpath = files.fileoupload.path;
	      var newpath = '/home/ubuntu/Desktop/Node ww3school.com/test/' + files.filetoupload.name;
	      fs.rename(oldpath, newpath, function(err){
	        if(err) throw err;
	        res.write('File uploaded and moved!');
	        res.end();
	      });
	    });
	  } else {
	    res.writeHead(200, {'Content-Type':'text/html'});
	    res.write('&lt;form action="fileupload" method="post" enctype="multipart/form-data");
	    res.write('&lt;input type="file" name="filetoupload">&lt;br>');
	    res.write('&lt;input type="submit" name="submit">');
	    return res.end();
	  }
	}).listen(8080)
</pre>
<h2 class="body">Node.js Email</h2>
<pre>npm install nodemailer</pre>
<h3>Send an Email</h3>
<p>xem tai day <a href="https://www.w3schools.com/nodejs/nodejs_email.asp" target="_blank">Click</a></p>
<h1 class="body">Node.js MySQL</h1>
<h2 class="body">MySQL Get Started</h2>
<h3>Cai dat</h3>

<ul><li>B1: Tai MySQL APT Repository</li></ul>
<a href="https://dev.mysql.com/downloads/repo/apt/" target="_blank">https://dev.mysql.com/downloads/repo/apt/</a>
<ul><li>B2: di chuyen den thu muc chua, va chay lenh</li></ul>
<p>Downloads, mo Ternimal, kiem tra file</p>
<pre>	ls -l</pre>
<p>cai dat file</p>
<pre>	sudo dpkg -i mysql-apt-config_0.8.18-1_all.deb</pre>
<p>lenh de kiem tra mysql-server</p>
<pre>	sudo apt-cache search mysql-server</pre>
<ul><li>B3: cai dat mysql-server</li></ul>
<pre> sudo apt-get install mysql</pre>
<p><b>Note</b>: Nho nhap mat khau, day la mat khau dang nhap root</p>
<ul><li>B4: dang nhap</li></ul>
<pre> sudo mysql -u root -p</pre>
<p><b>Note</b>: mysql la ten cua he thogn luu tru, co the thay doi</p>
<h3>start/stop/restart/status server</h3>
<p>Co 2 dong lenh tuong tu:</p>
<ul>
	<li><pre>sudo server mysql stop</pre></li>
	<li><pre>sudo systemctl stop mysql</pre></li>
</ul>
<h3>uninstall MySQL</h3>
<pre>	1.sudo apt-get remove --purge mysql*</pre>
<pre>	2.sudo apt-get purge mysql*</pre>
<pre>	3.sudo apt-get autoremove</pre>
<pre>	4.sudo apt-get autoclean</pre>
<pre>	5.sudo apt-get remove dbconfig-mysql</pre>
<br>
<b>Hoac</b>
<pre>	1.sudo apt-get remove mysql-server</pre>
<pre>	2.sudo apt-get autoremove</pre>
<pre>	3.sudo apt-get remove package-name (ten goi)</pre>
<h3>Cai them MySQL Workbench truc quan xu ly data</h3>
<a href="https://dev.mysql.com/downloads/workbench/" target="_blank">https://dev.mysql.com/downloads/workbench/</a>


</body>
</html>